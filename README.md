# Parallel stencil computations

Parallel implementation of stencil computations, also known as ISLs, using OpenMPI and OpenMP for distributed computing.

## Description

This repository contains the project for the UniTN HPC course for a.y. 2024-2025.

## Getting Started

### Dependencies

* OpenMPI
* OpenMP (optional)
* Matplotlib
* OpenCV

### Installing

Clone the repository and compile with Make
```
git clone https://github.com/simrossi/parallel_stencil
cd parallel_stencil
make
```

### Executing program

The program processes an input file containing a matrix and generates an output file with the resulting matrix. The file format consists of two rows: the first row specifies the dimensions, and the second row contains the continuous data.

The implementation allows for a sequential execution and a parallel execution by simply including or excluding the macro `PARALLEL` in `main.c`, line 13.

In case of any modification, a re-compiling is required trough
```
make clean && make
```

In case of sequential execution you can simply type:
```
./stencil -i <input_file> -o <output_file> [-l <log_file>]
```

In the case of parallel execution, you can also define the number of processes to be generated by:
```
mpiexec -np n ./stencil -i <input_file> -o <output_file> [-l <log_file>]
```
where `n` defines the number of processes.

To change the stencil and the operation to perform modify the arguments provided to `init_stencil()` in `src/main.c`.
A list of different stencils can be found in `src/patterns.h` while all different operations are contained in `src/operations.h`.

### Python scripts

The folder `scripts/` contains some python scripts that can be used to perform various operations.

### Image
One of them is `image.py` which allows to apply the stencil computation to a provided image.

```
./image.py <number of processes> <stencil_binary> <image> <output_directory> [output log]
```

The command above will save the resulting image in the specified `output_directory`.

### Video

`video.py` allows to apply the stencil computation to a video which is just a composition of images (frames).

```
./video.py <number of processes> <stencil_binary> <video_path> <output_dir> <video name output>
```

The command above will save the extracted frames and the computed ones in the specified `output_directory` and generate a new video with the name `video name output`.
The new `video name` MUST contain also a proper `extension` such as mp4, mp3.

Keep in mind that if the video has a large resolution and/or contains lot of frames it might require lot of computation and also space as it need to save a pair of images for each frame.

#### Examples of outputs

<p style="display:flex; justify-content: space-around">
    <img src="./outputs/city.jpg" width="380"/>
    <img src="./outputs/city-stencil.jpg" width="380"/>
</p>

<p style="display:flex; justify-content: space-around">
    <img src="./outputs/galaxy.jpg" width="380"/>
    <img src="./outputs/galaxy-stencil.jpg" width="380"/>
</p>

The folder `outputs` contains the examples showed above and other image / video outputs generates by applying ISLs.

### Expand program

The program can be expanded by adding new stencils and new operations:
* To add a new stencil create a funcion declaration in `src/patterns.h` and its definition in `src/patterns.c`.
* To add a new operation create a function declaration in `src/operations.h` and its definition in `src/operations.c`.

You can guide yourself by looking at already existing stencils and operations.
Don't forget to apply your new changes by running `make clean && make`.

## Authors

Contributors names and contact info

Simone Rossi: [@simrossi](https://github.com/simrossi) [257777]

Dorijan Di Zepp: [@najirod02](https://github.com/najirod02) [257827]

## License

This project is licensed under the GPLv3 License - see the LICENSE file for details